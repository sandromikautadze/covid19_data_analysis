---
title: "Report: COVID-19 Data Analysis with R"
author: "Sandro Mikautadze"
output: html_document
---

```{r include = FALSE}
library(tibble)
library(dplyr)
covid19_raw <- read.csv("raw_data/covid19.csv")
covid19_allstates <- covid19_raw %>% filter(Province_State == "All States")

covid19_allstates_daily <- covid19_allstates %>% select(Date,
                                                        Country_Region,
                                                        active,
                                                        hospitalizedCurr,
                                                        daily_tested,
                                                        daily_positive
                                                        )
covid19_allstates_daily_sum <- covid19_allstates_daily %>% 
                               group_by(Country_Region) %>%
                               summarise(tested = daily_tested %>% sum,
                                         positive = daily_positive %>% sum,
                                         active = active %>% sum,
                                         hospitalized = hospitalizedCurr %>% sum
                               ) %>%
                               arrange(-tested)
covid19_top10 <- head(covid19_allstates_daily_sum, 10)
countries <- covid19_top10 %>% pull(Country_Region)

```


# Introduction

## What is the project about?

The following project is an individual assignment taken from a course on Dataquest (put link).
The aim is to analyse a set of data collected from January 20th to June 1st 2020 taken from Kaggle, about Covid-19 [put link of the dataset].
The research questions are the following:

* **Q1**: which countries have had the highest number of positive cases against the number of tests?

* **Q2**: which countries have had the highest number of deaths due to COVID-19?

* **Q3**: which countries have made the best effort in terms of the number of COVID-19 tests conducted related to their population?

* **Q4**: which countries were ultimately the most and least affected related to their population?

The type of analysis is purely **descriptive**.
All the snippets of code in this report use variables defined in the scripts.

# Data

## Raw data overview

We first analyse the dimensions, the column names and the information provided by each column in the data set: 

```{r}
glimpse(covid19_raw)
```

Looking at the data set repository from Kaggle we have further information on the meaning of each column:

* **Date**: date of the data collection

* **Country_Region**: country names

* **Province_State** : state/province names; value "All States" is put when state/provincial level data is NA

* **positive** : cumulative number of positive cases reported

* **active** : number of actively cases on that day

* **hospitalized** : cumulative number of hospitalized cases reported

* **hospitalizedCurr** : number of actively hospitalized cases on that day

* **recovered** : cumulative number of recovered cases reported

* **death** : cumulative number of deaths reported

* **total tested** : cumulative number of tests conducted

**Note**: Not all columns in our version of the data frame where present in the data description on Kaggle at the time of download. This indicates that the downloaded file was not updated to a later version of the data set. \\Yet, Dataquest gives the information provided by the other columns:

* **Continent_Name** : continent name

* **Two_Letter_Country_Code** : country codes

* **Country_Region** : country names

* **daily_tested** : number of tests conducted on the day; if daily data is unavailable, daily tested is averaged across number of days in between

* **daily_positive** : number of positive cases reported on the day; if daily data is unavailable, daily positive is averaged across number of days in

## Raw Data Cleaning

### Data Cleaning Q1

The first clean that we do is removing the **Province_State** column. Indeed, it might create some unwanted bias, as it also gives information about the specific province. So, to make the data analysis "nationalized", we avoid considering precise regions, and consider only those rows with "All States" value.

```{r}
glimpse(covid19_allstates)
```

As we can see we're left with just 30% of the data we had previously.

The second thing that we need to be aware of is the "unit of measurement" adopted by each column. For example, there are factors with cumulative information, others with daily information. To better address our research questions, we only consider the columns providing daily data, that is **Date**, **Country_Region**, **active**, **hospitalizedCurr**, **daily_tested**, **daily_positive**. We get the following data frame:
```{r}
glimpse(covid19_allstates_daily)
```

Now data has been cleaned for Q1.

### Data Cleaning for Q2

### Data Cleaning for Q3

### Data Cleaning for Q4


# Analysis

## Data Analysis for Q1

Recall that with Q1 we are trying to answer the following question: *which countries have had the highest number of positive cases against the number of tests?*

Based on our cleaned data set, we notice that our data is based on a daily basis. Therefore we want to find the ratios on the overall number of positive cases over the total number of tests performed in each country. So we want to create a data set that groups **Country_Region** and aggregates data over all tests made, positive, active and hospitalized cases in that period time. 

Displaying the countries based on descending order of tests we get:

```{r}
head(covid19_allstates_daily_sum, 10)
```

Now, in theory the result can be easily found by dividing the **positive** cases over the **tested** column and rank the result for each country. We are going to do it using vectors, extracted from the data frame, as an exercise.

We first extract a vector of the countries in the top 10:
```{r}
countries
```

**Note**: if we extract the vector on the whole cleaned data set we get that the length of the vector of countries is 108, so we cover more than half of the world with our data. The reason we do our analysis on just the top 10 is because we have more data on the tests made, and hence a better chance of having the correct data. As a matter of fact, there might be countries with higher ratios, but more incorrect and non sufficient data, making our data exploration biased.

Conclude on final parts of the report. 

